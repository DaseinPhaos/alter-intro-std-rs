<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>std::borrow</title>

    <link rel="stylesheet" type="text/css" href="rustbook.css">

    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    
                <div id="nav">
                    <button id="toggle-nav">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                    </button>
                </div>
<div id='toc' class='mobile-hidden'>
<ol class='chapter'>
<li><a  href='README.html'><b>1.</b> Introduction</a>
</li>
<li><a  href='macros-readme.html'><b>2.</b> Macros in std</a>
</li>
<li><a  href='mods-readme.html'><b>3.</b> Uncategorized Modules</a>
<ol class='section'>
<li><a  href='any-readme.html'><b>3.1.</b> std::any</a>
</li>
<li><a  href='ascii-readme.html'><b>3.2.</b> std::ascii</a>
</li>
<li><a class='active' href='borrow-readme.html'><b>3.3.</b> std::borrow</a>
</li>
<li><a  href='boxed-readme.html'><b>3.4.</b> std::boxed</a>
</li>
<li><a  href='cell-readme.html'><b>3.5.</b> std::cell</a>
</li>
<li><a  href='clone-readme.html'><b>3.6.</b> std::clone</a>
</li>
<li><a  href='cmp-readme.html'><b>3.7.</b> std::cmp</a>
</li>
<li><a  href='collections-readme.html'><b>3.8.</b> std::collections</a>
</li>
<li><a  href='convert-readme.html'><b>3.9.</b> std::convert</a>
</li>
<li><a  href='default-readme.html'><b>3.10.</b> std::default</a>
</li>
<li><a  href='env-readme.html'><b>3.11.</b> std::env</a>
</li>
<li><a  href='error-readme.html'><b>3.12.</b> std::error</a>
</li>
<li><a  href='ffi-readme.html'><b>3.13.</b> std::ffi</a>
</li>
<li><a  href='fmt-readme.html'><b>3.14.</b> std::fmt</a>
</li>
<li><a  href='fs-readme.html'><b>3.15.</b> std::fs</a>
</li>
<li><a  href='hash-readme.html'><b>3.16.</b> std::hash</a>
</li>
<li><a  href='io-readme.html'><b>3.17.</b> std::io</a>
</li>
</ol>
</li>
</ol>
</div>
<div id='page-wrapper'>
<div id='page'>


    <h1 class="title">std::borrow</h1>
    <blockquote>
<p><a href="https://doc.rust-lang.org/std/borrow/">https://doc.rust-lang.org/std/borrow/</a></p>
</blockquote>

<p>In Rust, borrowing generally comes in the flavor of reference: type <code>T</code> can be borrowed as <code>&amp; T</code> or <code>&amp;mut T</code>. However, the concept of borrowing can extend beyond the form of simple reference. Custom types may provide additional kind of borrowing. For example, <code>Vec&lt;T&gt;</code> introduces borrowed slices <code>&amp;[T]</code> and <code>&amp;mut [T]</code>.</p>

<p>To capture the general concept of borrowing, this module defines two traits.</p>

<p>First comes the <code>Borrow</code> trait:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>pub</span> <span class='kw'>trait</span> <span class='ident'>Borrow</span><span class='op'>&lt;</span><span class='ident'>Borrowed</span>: <span class='question-mark'>?</span><span class='ident'>Sized</span><span class='op'>&gt;</span> {
    <span class='kw'>fn</span> <span class='ident'>borrow</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='ident'>Borrowed</span>;
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Apub%20trait%20Borrow%3CBorrowed%3A%20%3FSized%3E%20%7B%0A%20%20%20%20fn%20borrow(%26self)%20-%3E%20%26Borrowed%3B%0A%7D%0A%7D">Run</a></pre>

<p>If type <code>T</code> implements <code>Borrow&lt;Borrowed&gt;</code>, then <code>&amp; T</code> can be borrowed immutably as <code>&amp; Borrowed</code>. Such design allows a single type to be borrowed as multiple different types. For example, <code>Vec&lt;T&gt;</code> implements both <code>Borrow&lt;Vec&lt;T&gt;&gt;</code> and <code>Borrow&lt;[T]&gt;</code>, thus a <code>&amp; Vec&lt;T&gt;</code> can be borrowed both as a <code>&amp; Vec&lt;T&gt;</code> or as a <code>&amp; [T]</code>.</p>

<p>The required method <code>fn borrow(&amp;self) -&gt; &amp;Borrowed</code> performs the actual borrowing.</p>

<p>To demonstrate its usage, check out how the module implements it for generic type <code>T</code>:</p>

<pre class='rust rust-example-rendered'>
<span class='comment'>// Of course `&amp; T` can be borrowed as `&amp; T`.</span>
<span class='kw'>impl</span> <span class='op'>&lt;</span><span class='ident'>T</span>: <span class='question-mark'>?</span><span class='ident'>Sized</span><span class='op'>&gt;</span> <span class='ident'>Borrow</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> <span class='kw'>for</span> <span class='ident'>T</span> {
    <span class='kw'>fn</span> <span class='ident'>borrow</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='ident'>T</span> { <span class='self'>self</span> }
}

<span class='comment'>// `&amp;&amp;&#39;a T` can be borrowed as `&amp; T`.</span>
<span class='kw'>impl</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>T</span>:<span class='question-mark'>?</span><span class='ident'>Sized</span><span class='op'>&gt;</span> <span class='ident'>Borrow</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> <span class='kw'>for</span> <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='ident'>T</span> {
    <span class='kw'>fn</span> <span class='ident'>borrow</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='ident'>T</span> { <span class='kw-2'>&amp;</span><span class='kw-2'>*</span><span class='kw-2'>*</span><span class='self'>self</span> }
}

<span class='comment'>// `&amp;&amp;&#39;a mut T` can be borrowed as `&amp; T`.</span>
<span class='kw'>impl</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>T</span>: <span class='question-mark'>?</span><span class='ident'>Sized</span><span class='op'>&gt;</span> <span class='ident'>Borrow</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> <span class='kw'>for</span> <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> <span class='ident'>T</span> {
    <span class='kw'>fn</span> <span class='ident'>borrow</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='ident'>T</span> { <span class='kw-2'>&amp;</span><span class='kw-2'>*</span><span class='kw-2'>*</span><span class='self'>self</span> }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0A%2F%2F%20Of%20course%20%60%26%20T%60%20can%20be%20borrowed%20as%20%60%26%20T%60.%0Aimpl%20%3CT%3A%20%3FSized%3E%20Borrow%3CT%3E%20for%20T%20%7B%0A%20%20%20%20fn%20borrow(%26self)%20-%3E%20%26T%20%7B%20self%20%7D%0A%7D%0A%0A%2F%2F%20%60%26%26'a%20T%60%20can%20be%20borrowed%20as%20%60%26%20T%60.%0Aimpl%3C'a%2C%20T%3A%3FSized%3E%20Borrow%3CT%3E%20for%20%26'a%20T%20%7B%0A%20%20%20%20fn%20borrow(%26self)%20-%3E%20%26T%20%7B%20%26**self%20%7D%0A%7D%0A%0A%2F%2F%20%60%26%26'a%20mut%20T%60%20can%20be%20borrowed%20as%20%60%26%20T%60.%0Aimpl%3C'a%2C%20T%3A%20%3FSized%3E%20Borrow%3CT%3E%20for%20%26'a%20mut%20T%20%7B%0A%20%20%20%20fn%20borrow(%26self)%20-%3E%20%26T%20%7B%20%26**self%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>Another example from <code>Box&lt;T&gt;</code>:</p>

<pre class='rust rust-example-rendered'>
<span class='comment'>// `&amp; Box&lt;T&gt;` can be borrowed as `&amp; T`</span>
<span class='kw'>impl</span><span class='op'>&lt;</span><span class='ident'>T</span>: <span class='question-mark'>?</span><span class='ident'>Sized</span><span class='op'>&gt;</span> <span class='ident'>Borrow</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> <span class='kw'>for</span> <span class='ident'>Box</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> {
    <span class='kw'>fn</span> <span class='ident'>borrow</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='ident'>T</span> { <span class='kw-2'>&amp;</span><span class='kw-2'>*</span><span class='kw-2'>*</span><span class='self'>self</span> }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0A%2F%2F%20%60%26%20Box%3CT%3E%60%20can%20be%20borrowed%20as%20%60%26%20T%60%0Aimpl%3CT%3A%20%3FSized%3E%20Borrow%3CT%3E%20for%20Box%3CT%3E%20%7B%0A%20%20%20%20fn%20borrow(%26self)%20-%3E%20%26T%20%7B%20%26**self%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>Then there is <code>BorrowMut</code>:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>pub</span> <span class='kw'>trait</span> <span class='ident'>BorrowMut</span><span class='op'>&lt;</span><span class='ident'>Borrowed</span>: <span class='question-mark'>?</span><span class='ident'>Sized</span><span class='op'>&gt;</span> : <span class='ident'>Borrow</span><span class='op'>&lt;</span><span class='ident'>Borrowed</span><span class='op'>&gt;</span> {
    <span class='kw'>fn</span> <span class='ident'>borrow_mut</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>Borrowed</span>;
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Apub%20trait%20BorrowMut%3CBorrowed%3A%20%3FSized%3E%20%3A%20Borrow%3CBorrowed%3E%20%7B%0A%20%20%20%20fn%20borrow_mut(%26mut%20self)%20-%3E%20%26mut%20Borrowed%3B%0A%7D%0A%7D">Run</a></pre>

<p>, which represents a mutable borrow. That is, suppose we have <code>T: BorrowMut&lt;U&gt;</code>, then <code>&amp;mut T</code> can be borrowed as <code>&amp;mut U</code>. Note that <code>BorrowMut</code> inherits from <code>Borrow</code>. This matches the semantic behavior of borrowing: we <em>can</em> borrow a <code>&amp; T</code> out from a <code>&amp;mut T</code>, not the opposite.</p>

<p>As we&#39;d expect, the module implements this trait for <code>T</code> and <code>&#39;a mut T</code>:</p>

<pre class='rust rust-example-rendered'>
<span class='comment'>// `&amp;mut T` can be borrowed as `&amp;mut T`</span>
<span class='kw'>impl</span><span class='op'>&lt;</span><span class='ident'>T</span>: <span class='question-mark'>?</span><span class='ident'>Sized</span><span class='op'>&gt;</span> <span class='ident'>BorrowMut</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> <span class='kw'>for</span> <span class='ident'>T</span> {
    <span class='kw'>fn</span> <span class='ident'>borrow_mut</span><span class='op'>&lt;</span><span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span><span class='op'>&gt;</span> <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>T</span> { <span class='self'>self</span> }
}

<span class='comment'>// `&amp;mut &amp;&#39;a mut T` can be borrowed as `&amp;mut T`</span>
<span class='kw'>impl</span><span class='op'>&lt;</span><span class='ident'>T</span>: <span class='question-mark'>?</span><span class='ident'>Sized</span><span class='op'>&gt;</span> <span class='ident'>BorrowMut</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> <span class='kw'>for</span> <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='kw-2'>mut</span> <span class='ident'>T</span> {
    <span class='kw'>fn</span> <span class='ident'>borrow_mut</span><span class='op'>&lt;</span><span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span><span class='op'>&gt;</span> <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>T</span> { <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='kw-2'>*</span><span class='kw-2'>*</span><span class='self'>self</span> }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0A%2F%2F%20%60%26mut%20T%60%20can%20be%20borrowed%20as%20%60%26mut%20T%60%0Aimpl%3CT%3A%20%3FSized%3E%20BorrowMut%3CT%3E%20for%20T%20%7B%0A%20%20%20%20fn%20borrow_mut%3C%26mut%20self%3E%20-%3E%20%26mut%20T%20%7B%20self%20%7D%0A%7D%0A%0A%2F%2F%20%60%26mut%20%26'a%20mut%20T%60%20can%20be%20borrowed%20as%20%60%26mut%20T%60%0Aimpl%3CT%3A%20%3FSized%3E%20BorrowMut%3CT%3E%20for%20%26'a%20mut%20T%20%7B%0A%20%20%20%20fn%20borrow_mut%3C%26mut%20self%3E%20-%3E%20%26mut%20T%20%7B%20%26mut%20**self%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>Another example from <code>Box&lt;T&gt;</code>:</p>

<pre class='rust rust-example-rendered'>
<span class='comment'>// `&amp;mut Box&lt;T&gt;` can be borrowed as `&amp;mut T`</span>
<span class='kw'>impl</span><span class='op'>&lt;</span><span class='ident'>T</span>: <span class='question-mark'>?</span><span class='ident'>Sized</span><span class='op'>&gt;</span> <span class='ident'>BorrowMut</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> <span class='kw'>for</span> <span class='ident'>Box</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> {
    <span class='kw'>fn</span> <span class='ident'>borrow</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>T</span> { <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='kw-2'>*</span><span class='kw-2'>*</span><span class='self'>self</span> }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0A%2F%2F%20%60%26mut%20Box%3CT%3E%60%20can%20be%20borrowed%20as%20%60%26mut%20T%60%0Aimpl%3CT%3A%20%3FSized%3E%20BorrowMut%3CT%3E%20for%20Box%3CT%3E%20%7B%0A%20%20%20%20fn%20borrow(%26mut%20self)%20-%3E%20%26mut%20T%20%7B%20%26mut%20**self%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>One thing worth noting is that, if both <code>Self</code> and <code>Borrowed</code> implement <code>Hash</code>, <code>Eq</code> and/or <code>Ord</code>, they must produce the same result. This should be true for both <code>Borrow</code> and <code>BorrowMut</code>.</p>

<p>Another thing worth mention is the difference between <code>Borrow</code> and <code>AsRef</code>. Check out <a href="https://doc.rust-lang.org/book/borrow-and-asref.html">The Book</a>.</p>

<p>There is yet another trait in this module, the <code>ToOwned</code> trait:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>pub</span> <span class='kw'>trait</span> <span class='ident'>ToOwned</span> {
    <span class='kw'>type</span> <span class='ident'>Owned</span>: <span class='ident'>Borrow</span><span class='op'>&lt;</span><span class='self'>Self</span><span class='op'>&gt;</span>;
    <span class='kw'>fn</span> <span class='ident'>to_owned</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='self'>Self</span>::<span class='ident'>Owned</span>;
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Apub%20trait%20ToOwned%20%7B%0A%20%20%20%20type%20Owned%3A%20Borrow%3CSelf%3E%3B%0A%20%20%20%20fn%20to_owned(%26self)%20-%3E%20Self%3A%3AOwned%3B%0A%7D%0A%7D">Run</a></pre>

<p>While <code>T:Borrow&lt;U&gt;</code> allows <code>&amp; T</code> to be borrowed as <code>&amp; U</code>, <code>U:ToOwned&lt;Owned=T&gt;</code> allows <code>&amp;U</code>, being borrowed from some <code>&amp;T</code>, to return a new instance of <code>T</code>. It can be perceived as a generalization of <code>Clone</code>. Say for <code>String</code>, the <code>Clone</code> trait it implements allows us to write:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>let</span> <span class='ident'>some_string</span> <span class='op'>=</span> <span class='ident'>String</span>::<span class='ident'>from</span>(<span class='string'>&quot;Oh Captain&quot;</span>);
<span class='kw'>let</span> <span class='ident'>cloned_string</span> <span class='op'>=</span> <span class='ident'>some_string</span>.<span class='ident'>clone</span>();<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Alet%20some_string%20%3D%20String%3A%3Afrom(%22Oh%20Captain%22)%3B%0Alet%20cloned_string%20%3D%20some_string.clone()%3B%0Aassert_eq!(some_string%2C%20cloned_string)%3B%0A%7D%0A">Run</a></pre>

<p>However, say for some reason we&#39;d like the <code>cloned_string</code> to contain only the first word <code>&quot;Oh&quot;</code>. Our immediate reflection would be like, ok, let&#39;s just make a string slice and see what we can do with that:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>let</span> <span class='ident'>some_string</span> <span class='op'>=</span> <span class='ident'>String</span>::<span class='ident'>from</span>(<span class='string'>&quot;Oh Captain&quot;</span>);
<span class='kw'>let</span> <span class='ident'>oh</span> <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='ident'>some_string</span>[..<span class='number'>2</span>];
<span class='kw'>let</span> <span class='ident'>cloned_string</span> <span class='op'>=</span> <span class='ident'>oh</span>.<span class='ident'>clone</span>();<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Alet%20some_string%20%3D%20String%3A%3Afrom(%22Oh%20Captain%22)%3B%0Alet%20oh%20%3D%20%26some_string%5B..2%5D%3B%0Alet%20cloned_string%20%3D%20oh.clone()%3B%0Aassert_eq!(cloned_string%2C%20%22Oh%22)%3B%0A%7D%0A">Run</a></pre>

<p>The code compiles, except that the result is not what we wanted: <code>cloned_string</code> now has type <code>&amp;str</code> rather than the <code>String</code> we&#39;d hope for. This is where the <code>ToOwned</code> trait comes to rescue.</p>

<p>As <code>str</code> implements <code>ToOwned&lt;String&gt;</code>, one can write:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>let</span> <span class='ident'>some_string</span> <span class='op'>=</span> <span class='ident'>String</span>::<span class='ident'>from</span>(<span class='string'>&quot;Oh Captain&quot;</span>);
<span class='kw'>let</span> <span class='ident'>oh</span> <span class='op'>=</span> <span class='kw-2'>&amp;</span><span class='ident'>some_string</span>[..<span class='number'>2</span>];
<span class='kw'>let</span> <span class='ident'>cloned_string</span> <span class='op'>=</span> <span class='ident'>oh</span>.<span class='ident'>to_owned</span>();
<span class='comment'>// Now we are happy.</span><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Alet%20some_string%20%3D%20String%3A%3Afrom(%22Oh%20Captain%22)%3B%0Alet%20oh%20%3D%20%26some_string%5B..2%5D%3B%0Alet%20cloned_string%20%3D%20oh.to_owned()%3B%0A%2F%2F%20Now%20we%20are%20happy.%0Aassert_eq!(cloned_string%2C%20%22Oh%22)%3B%0A%7D%0A">Run</a></pre>

<p>Now we are happy. To conclude, <code>ToOwned</code> trait extends the concept of cloning to the generalized borrowing senario. If <code>T: ToOwned&lt;Owned=U&gt;</code>, then a <code>&amp; T</code>, being borrowed from some <code>&amp; U</code>, can make a clone of what it&#39;s borrowing by calling <code>to_owned</code> on itself.<sup id="fnref1"><a href="#fn1" rel="footnote">1</a></sup></p>

<p>Note that the module implements <code>ToOwned&lt;Owned=T&gt;</code> for <code>T: Clone</code>. The implementation is trivial, as we&#39;d expect:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>impl</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> <span class='ident'>ToOwned</span> <span class='kw'>for</span> <span class='ident'>T</span> <span class='kw'>where</span> <span class='ident'>T</span>: <span class='ident'>Clone</span> {
    <span class='kw'>type</span> <span class='ident'>Owned</span> <span class='op'>=</span> <span class='ident'>T</span>;
    <span class='kw'>fn</span> <span class='ident'>to_owned</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>T</span> {
        <span class='self'>self</span>.<span class='ident'>clone</span>()
    }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Aimpl%3CT%3E%20ToOwned%20for%20T%20where%20T%3A%20Clone%20%7B%0A%20%20%20%20type%20Owned%20%3D%20T%3B%0A%20%20%20%20fn%20to_owned(%26self)%20-%3E%20T%20%7B%0A%20%20%20%20%20%20%20%20self.clone()%0A%20%20%20%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>Finally, the module defines <code>Cow</code>, providing clone-on-write functionality:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>pub</span> <span class='kw'>enum</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>B</span>: <span class='question-mark'>?</span><span class='ident'>Sized</span> <span class='op'>+</span> <span class='lifetime'>&#39;a</span> <span class='op'>+</span> <span class='ident'>ToOwned</span><span class='op'>&gt;</span> {
    <span class='ident'>Borrowed</span>(<span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='ident'>B</span>),
    <span class='ident'>Owned</span>(<span class='ident'>B</span> <span class='kw'>as</span> <span class='ident'>ToOwned</span>)::<span class='ident'>Owned</span>),
}

<span class='comment'>// ...</span>

<span class='kw'>impl</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>B</span>: <span class='question-mark'>?</span><span class='ident'>Sized</span><span class='op'>&gt;</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>B</span><span class='op'>&gt;</span> <span class='kw'>where</span> <span class='ident'>B</span>: <span class='ident'>ToOwned</span> {
    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>to_mut</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='op'>&lt;</span><span class='ident'>B</span> <span class='kw'>as</span> <span class='ident'>ToOwned</span><span class='op'>&gt;</span>::<span class='ident'>Owned</span> {
        <span class='kw'>match</span> <span class='kw-2'>*</span><span class='self'>self</span> {
            <span class='ident'>Borrowed</span>(<span class='ident'>borrowed</span>) <span class='op'>=&gt;</span> {
                <span class='kw-2'>*</span><span class='self'>self</span> <span class='op'>=</span> <span class='ident'>Owned</span>(<span class='ident'>borrowed</span>.<span class='ident'>to_owned</span>());
                <span class='kw'>match</span> <span class='kw-2'>*</span><span class='self'>self</span> {
                    <span class='ident'>Borrow</span>(..) <span class='op'>=&gt;</span> <span class='macro'>unreachable</span><span class='macro'>!</span>(),
                    <span class='ident'>Owned</span>(<span class='kw-2'>ref</span> <span class='kw-2'>mut</span> <span class='ident'>owned</span>) <span class='op'>=&gt;</span> <span class='ident'>owned</span>,
                }
            }
            <span class='ident'>Owned</span>(<span class='kw-2'>ref</span> <span class='kw-2'>mut</span> <span class='ident'>owned</span>) <span class='op'>=&gt;</span> <span class='ident'>owned</span>,
        }
    }

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>into_owned</span>(<span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='op'>&lt;</span><span class='ident'>B</span> <span class='kw'>as</span> <span class='ident'>ToOwned</span><span class='op'>&gt;</span>::<span class='ident'>Owned</span> {
        <span class='kw'>match</span> <span class='self'>self</span> {
            <span class='ident'>Borrowed</span>(<span class='ident'>borrowed</span>) <span class='op'>=&gt;</span> <span class='ident'>borrowed</span>.<span class='ident'>to_owned</span>(),
            <span class='ident'>Owned</span>(<span class='ident'>owned</span>) <span class='op'>=&gt;</span> <span class='ident'>owned</span>,
        }
    }
}
<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Apub%20enum%20Cow%3C'a%2C%20B%3A%20%3FSized%20%2B%20'a%20%2B%20ToOwned%3E%20%7B%0A%20%20%20%20Borrowed(%26'a%20B)%2C%0A%20%20%20%20Owned(B%20as%20ToOwned)%3A%3AOwned)%2C%0A%7D%0A%0A%2F%2F%20...%0A%0Aimpl%3C'a%2C%20B%3A%20%3FSized%3E%20Cow%3C'a%2C%20B%3E%20where%20B%3A%20ToOwned%20%7B%0A%20%20%20%20pub%20fn%20to_mut(%26mut%20self)%20-%3E%20%26mut%20%3CB%20as%20ToOwned%3E%3A%3AOwned%20%7B%0A%20%20%20%20%20%20%20%20match%20*self%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20Borrowed(borrowed)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*self%20%3D%20Owned(borrowed.to_owned())%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20match%20*self%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Borrow(..)%20%3D%3E%20unreachable!()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Owned(ref%20mut%20owned)%20%3D%3E%20owned%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20Owned(ref%20mut%20owned)%20%3D%3E%20owned%2C%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20into_owned(self)%20-%3E%20%3CB%20as%20ToOwned%3E%3A%3AOwned%20%7B%0A%20%20%20%20%20%20%20%20match%20self%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20Borrowed(borrowed)%20%3D%3E%20borrowed.to_owned()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20Owned(owned)%20%3D%3E%20owned%2C%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>A <code>Cow&lt;&#39;a, B&gt;</code> might initially just hold some reference <code>&amp;&#39;a B</code> in its <code>Borrowed</code> variant like this:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>borrow</span>::<span class='ident'>Cow</span>;
<span class='kw'>let</span> <span class='ident'>numbers</span> <span class='op'>=</span> <span class='macro'>vec</span><span class='macro'>!</span>[<span class='number'>1</span>, <span class='number'>2</span>, <span class='number'>3</span>, <span class='number'>4</span>, <span class='number'>5</span>];
<span class='kw'>let</span> <span class='ident'>cow</span> <span class='op'>=</span> <span class='ident'>Cow</span>::<span class='ident'>Borrowed</span>(<span class='kw-2'>&amp;</span><span class='ident'>numbers</span>[<span class='number'>1</span>..<span class='number'>4</span>]);
<span class='macro'>println</span><span class='macro'>!</span>(<span class='string'>&quot;{}&quot;</span>, <span class='ident'>cow</span>);<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Ause%20std%3A%3Aborrow%3A%3ACow%3B%0Alet%20numbers%20%3D%20vec!%5B1%2C%202%2C%203%2C%204%2C%205%5D%3B%0Alet%20cow%20%3D%20Cow%3A%3ABorrowed(%26numbers%5B1..4%5D)%3B%0Aprintln!(%22%7B%7D%22%2C%20cow)%3B%0A%7D">Run</a></pre>

<p>. As such, it&#39;s just pointing into something owned by others. However, when mutability is required, it would by then lazily perform <code>B: ToOwned</code>&#39;s <code>to_owned</code> method, changing its content to the <code>Owned(..)</code> variant.</p>

<p>When <code>to_mut</code> method is invoked, the lazy clone(actually <code>to_owned</code>) would be performed(if not already), and a mutable reference to the newly cloned data would be returned. When <code>into_owned</code> is invoked, the invoking <code>Cow</code> would be consumed, returning the newly cloned(if not already) data by value. Continueing the example above, say if we want to change the content of the newly created <code>cow</code>:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>cow</span> <span class='op'>=</span> <span class='ident'>cow</span>.<span class='ident'>into_owned</span>();
<span class='ident'>cow</span>[<span class='number'>1</span>] <span class='op'>=</span> <span class='number'>6</span>;
<span class='macro'>assert_eq</span><span class='macro'>!</span>(<span class='macro'>vec</span><span class='macro'>!</span>[<span class='number'>2</span>, <span class='number'>6</span>, <span class='number'>4</span>], <span class='ident'>cow</span>);<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0A%20%20%20use%20std%3A%3Aborrow%3A%3ACow%3B%0A%20%20%20let%20numbers%20%3D%20vec!%5B1%2C%202%2C%203%2C%204%2C%205%5D%3B%0A%20%20%20let%20cow%20%3D%20Cow%3A%3ABorrows(%26numbers%5B1..4%5D)%3B%0Alet%20mut%20cow%20%3D%20cow.into_owned()%3B%0Acow%5B1%5D%20%3D%206%3B%0Aassert_eq!(vec!%5B2%2C%206%2C%204%5D%2C%20cow)%3B%0A%7D%0A">Run</a></pre>

<p>Several <code>std</code>-traits are implemented for <code>Cow&lt;&#39;a, B&gt;</code>, such as <code>Hash</code>, <code>Debug</code>, <code>Display</code>, <code>Clone</code>, <code>Eq</code>, <code>Ord</code> and so on. Among them, the <code>Deref</code> trait is worth mentioning:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>impl</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>B</span>: <span class='question-mark'>?</span><span class='ident'>Sized</span><span class='op'>&gt;</span> <span class='ident'>Deref</span> <span class='kw'>for</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>B</span><span class='op'>&gt;</span> <span class='kw'>where</span> <span class='ident'>B</span>: <span class='ident'>ToOwned</span> {
    <span class='kw'>type</span> <span class='ident'>Target</span> <span class='op'>=</span> <span class='ident'>B</span>;

    <span class='kw'>fn</span> <span class='ident'>deref</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='ident'>B</span> {
        <span class='kw'>match</span> <span class='kw-2'>*</span><span class='self'>self</span> {
            <span class='ident'>Borrowed</span>(<span class='ident'>borrowed</span>) <span class='op'>=&gt;</span> <span class='ident'>borrowed</span>,
            <span class='ident'>Owned</span>(<span class='kw-2'>ref</span> <span class='ident'>owned</span>) <span class='op'>=&gt;</span> <span class='ident'>owned</span>.<span class='ident'>borrow</span>(),
        }
    }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Aimpl%3C'a%2C%20B%3A%20%3FSized%3E%20Deref%20for%20Cow%3C'a%2C%20B%3E%20where%20B%3A%20ToOwned%20%7B%0A%20%20%20%20type%20Target%20%3D%20B%3B%0A%0A%20%20%20%20fn%20deref(%26self)%20-%3E%20%26B%20%7B%0A%20%20%20%20%20%20%20%20match%20*self%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20Borrowed(borrowed)%20%3D%3E%20borrowed%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20Owned(ref%20owned)%20%3D%3E%20owned.borrow()%2C%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>This allows <code>Cow&lt;&#39;a, B&gt;</code> to be deref-coerced as <code>&amp;B</code>.</p>

<p>The <code>std::convert::From</code> trait is also worth mentioning. The trait allows the following code:</p>

<pre class='rust rust-example-rendered'>
    <span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>borrow</span>::<span class='ident'>Cow</span>;
    <span class='kw'>let</span> <span class='ident'>cow</span> <span class='op'>=</span> <span class='ident'>Cow</span>::<span class='ident'>from</span>(<span class='string'>&quot;Foo&quot;</span>);<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0A%20%20%20%20use%20std%3A%3Aborrow%3A%3ACow%3B%0A%20%20%20%20let%20cow%20%3D%20Cow%3A%3Afrom(%22Foo%22)%3B%0A%20%20println!(%22%7B%7D%22%2C%20cow)%3B%0A%7D%0A">Run</a></pre>

<p>The actual implementation is something like the following:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>impl</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span> <span class='ident'>From</span><span class='op'>&lt;</span><span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='ident'>str</span><span class='op'>&gt;</span> <span class='kw'>for</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>str</span><span class='op'>&gt;</span> {
    <span class='kw'>fn</span> <span class='ident'>from</span>(<span class='ident'>s</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='ident'>str</span>) <span class='op'>-&gt;</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>str</span><span class='op'>&gt;</span> {
        <span class='comment'>// ...</span>
    }
}

<span class='kw'>impl</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span> <span class='ident'>From</span><span class='op'>&lt;</span><span class='ident'>String</span><span class='op'>&gt;</span> <span class='kw'>for</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>str</span><span class='op'>&gt;</span> {
    <span class='kw'>fn</span> <span class='ident'>from</span>(<span class='ident'>s</span>: <span class='ident'>String</span>) <span class='op'>-&gt;</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>str</span><span class='op'>&gt;</span> {
        <span class='comment'>// ...</span>
    }
}

<span class='kw'>impl</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>T</span><span class='op'>&gt;</span> <span class='ident'>From</span><span class='op'>&lt;</span><span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> [<span class='ident'>T</span>]<span class='op'>&gt;</span> <span class='kw'>for</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, [<span class='ident'>T</span>]<span class='op'>&gt;</span> <span class='kw'>where</span> <span class='ident'>T</span>: <span class='ident'>Clone</span> {
    <span class='kw'>fn</span> <span class='ident'>from</span>(<span class='ident'>s</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> [<span class='ident'>T</span>]) <span class='op'>-&gt;</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, [<span class='ident'>T</span>]<span class='op'>&gt;</span> {
        <span class='comment'>// ...</span>
    }
}

<span class='kw'>impl</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, <span class='ident'>T</span><span class='op'>&gt;</span> <span class='ident'>From</span><span class='op'>&lt;</span><span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;&gt;</span> <span class='kw'>for</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, [<span class='ident'>T</span>]<span class='op'>&gt;</span> <span class='kw'>where</span> <span class='ident'>T</span>: <span class='ident'>Clone</span> {
    <span class='kw'>fn</span> <span class='ident'>from</span>(<span class='ident'>s</span>: <span class='ident'>Vec</span>[<span class='ident'>T</span>]) <span class='op'>-&gt;</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span>, [<span class='ident'>T</span>]<span class='op'>&gt;</span> {
        <span class='comment'>// ...</span>
    }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Aimpl%3C'a%3E%20From%3C%26'a%20str%3E%20for%20Cow%3C'a%2C%20str%3E%20%7B%0A%20%20%20%20fn%20from(s%3A%20%26'a%20str)%20-%3E%20Cow%3C'a%2C%20str%3E%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20...%0A%20%20%20%20%7D%0A%7D%0A%0Aimpl%3C'a%3E%20From%3CString%3E%20for%20Cow%3C'a%2C%20str%3E%20%7B%0A%20%20%20%20fn%20from(s%3A%20String)%20-%3E%20Cow%3C'a%2C%20str%3E%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20...%0A%20%20%20%20%7D%0A%7D%0A%0Aimpl%3C'a%2C%20T%3E%20From%3C%26'a%20%5BT%5D%3E%20for%20Cow%3C'a%2C%20%5BT%5D%3E%20where%20T%3A%20Clone%20%7B%0A%20%20%20%20fn%20from(s%3A%20%26'a%20%5BT%5D)%20-%3E%20Cow%3C'a%2C%20%5BT%5D%3E%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20...%0A%20%20%20%20%7D%0A%7D%0A%0Aimpl%3C'a%2C%20T%3E%20From%3CVec%3CT%3E%3E%20for%20Cow%3C'a%2C%20%5BT%5D%3E%20where%20T%3A%20Clone%20%7B%0A%20%20%20%20fn%20from(s%3A%20Vec%5BT%5D)%20-%3E%20Cow%3C'a%2C%20%5BT%5D%3E%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20...%0A%20%20%20%20%7D%0A%7D%0A%7D">Run</a></pre>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>The example here is pretty silly though, as one can simply reuse <code>String::from(oh)</code> instead.&nbsp;<a href="#fnref1" rev="footnote">&#8617;</a></p>
</li>

</ol>
</div>

    <script src='rustbook.js'></script>
</div></div>


</body>
</html>