<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>std::ffi</title>

    <link rel="stylesheet" type="text/css" href="rustbook.css">

    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    
                <div id="nav">
                    <button id="toggle-nav">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                    </button>
                </div>
<div id='toc' class='mobile-hidden'>
<ol class='chapter'>
<li><a  href='README.html'><b>1.</b> Introduction</a>
</li>
<li><a  href='macros-readme.html'><b>2.</b> Macros in std</a>
</li>
<li><a  href='mods-readme.html'><b>3.</b> Uncategorized Modules</a>
<ol class='section'>
<li><a  href='any-readme.html'><b>3.1.</b> std::any</a>
</li>
<li><a  href='ascii-readme.html'><b>3.2.</b> std::ascii</a>
</li>
<li><a  href='borrow-readme.html'><b>3.3.</b> std::borrow</a>
</li>
<li><a  href='boxed-readme.html'><b>3.4.</b> std::boxed</a>
</li>
<li><a  href='cell-readme.html'><b>3.5.</b> std::cell</a>
</li>
<li><a  href='clone-readme.html'><b>3.6.</b> std::clone</a>
</li>
<li><a  href='cmp-readme.html'><b>3.7.</b> std::cmp</a>
</li>
<li><a  href='collections-readme.html'><b>3.8.</b> std::collections</a>
</li>
<li><a  href='convert-readme.html'><b>3.9.</b> std::convert</a>
</li>
<li><a  href='default-readme.html'><b>3.10.</b> std::default</a>
</li>
<li><a  href='env-readme.html'><b>3.11.</b> std::env</a>
</li>
<li><a  href='error-readme.html'><b>3.12.</b> std::error</a>
</li>
<li><a class='active' href='ffi-readme.html'><b>3.13.</b> std::ffi</a>
</li>
<li><a  href='fmt-readme.html'><b>3.14.</b> std::fmt</a>
</li>
<li><a  href='fs-readme.html'><b>3.15.</b> std::fmt</a>
</li>
</ol>
</li>
</ol>
</div>
<div id='page-wrapper'>
<div id='page'>


    <h1 class="title">std::ffi</h1>
    <blockquote>
<p><a href="https://doc.rust-lang.org/std/ffi/">https://doc.rust-lang.org/std/ffi/</a></p>
</blockquote>

<p>This module defines some structs useful for FFI(foreign function interface) bindings. It primarily expose:</p>

<h1 id='cstring' class='section-header'><a href='#cstring'>CString</a></h1>
<p>This is a type representing an owned C-compatible string:</p>

<pre class='rust rust-example-rendered'>
<span class='attribute'>#[<span class='ident'>derive</span>(<span class='ident'>PartialEq</span>, <span class='ident'>PartialOrd</span>, <span class='ident'>Eq</span>, <span class='ident'>Ord</span>, <span class='ident'>Hash</span>, <span class='ident'>Clone</span>)]</span>
<span class='kw'>pub</span> <span class='kw'>struct</span> <span class='ident'>CString</span> {
    <span class='ident'>inner</span>: <span class='ident'>Box</span><span class='op'>&lt;</span>[<span class='ident'>u8</span>]<span class='op'>&gt;</span>,
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0A%23%5Bderive(PartialEq%2C%20PartialOrd%2C%20Eq%2C%20Ord%2C%20Hash%2C%20Clone)%5D%0Apub%20struct%20CString%20%7B%0A%20%20%20%20inner%3A%20Box%3C%5Bu8%5D%3E%2C%0A%7D%0A%7D">Run</a></pre>

<p>This type allows Rust code to generate C-compatible strings safely. An instance of such type is statically guaranteed to contain no interior <code>0: u8</code> in its <code>inner</code> field, and that the field always ends with a <code>0: u8</code>.</p>

<p>It can be constructed via the <code>new</code> associated function, or via the <code>unsafe</code> <code>from_vec_unchecked</code> associated function, or via the <code>unsafe</code> <code>from_raw</code> associated function. These functions are defined as follows:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>libc</span>;
<span class='kw'>use</span> <span class='ident'>memchr</span>;
<span class='kw'>use</span> <span class='ident'>slice</span>;
<span class='kw'>use</span> <span class='ident'>os</span>::<span class='ident'>raw</span>::<span class='ident'>c_char</span>;
<span class='kw'>use</span> <span class='ident'>mem</span>;
<span class='comment'>// ...</span>
<span class='kw'>impl</span> <span class='ident'>CString</span> {
    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>new</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span>(<span class='ident'>t</span>: <span class='ident'>T</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Result</span><span class='op'>&lt;</span><span class='ident'>CString</span>, <span class='ident'>NulError</span><span class='op'>&gt;</span>
        <span class='kw'>where</span> <span class='ident'>T</span>: <span class='ident'>Into</span><span class='op'>&lt;</span><span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>u8</span><span class='op'>&gt;&gt;</span> {
        <span class='self'>Self</span>::<span class='ident'>_new</span>(<span class='ident'>t</span>.<span class='ident'>into</span>())
    }

    <span class='kw'>fn</span> <span class='ident'>_new</span>(<span class='ident'>bytes</span>: <span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>u8</span><span class='op'>&gt;</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Result</span><span class='op'>&lt;</span><span class='ident'>CString</span>, <span class='ident'>NulError</span><span class='op'>&gt;</span> {
        <span class='kw'>match</span> <span class='ident'>memchr</span>::<span class='ident'>memchr</span>(<span class='number'>0</span>, <span class='kw-2'>&amp;</span><span class='ident'>bytes</span>) {
            <span class='prelude-val'>Some</span>(<span class='ident'>i</span>) <span class='op'>=&gt;</span> <span class='prelude-val'>Err</span>(<span class='ident'>NulError</span>(<span class='ident'>i</span>, <span class='ident'>bytes</span>)),
            <span class='prelude-val'>None</span> <span class='op'>=&gt;</span> <span class='prelude-val'>Ok</span>( <span class='kw'>unsafe</span> {
                <span class='ident'>CString</span>::<span class='ident'>from_vec_unchecked</span>(<span class='ident'>bytes</span>)
            })
        }
    }

    <span class='kw'>pub</span> <span class='kw'>unsafe</span> <span class='kw'>fn</span> <span class='ident'>from_vec_unchecked</span>(<span class='kw-2'>mut</span> <span class='ident'>v</span>: <span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>u8</span><span class='op'>&gt;</span>) <span class='op'>-&gt;</span> <span class='ident'>CString</span> {
        <span class='ident'>v</span>.<span class='ident'>reserve_exact</span>(<span class='number'>1</span>);
        <span class='ident'>v</span>.<span class='ident'>push</span>(<span class='number'>0</span>);
        <span class='ident'>CString</span>{ <span class='ident'>inner</span>: <span class='ident'>v</span>.<span class='ident'>into_boxed_slice</span>() }
    }

    <span class='kw'>pub</span> <span class='kw'>unsafe</span> <span class='kw'>fn</span> <span class='ident'>from_raw</span>(<span class='ident'>ptr</span>: <span class='kw-2'>*</span><span class='kw-2'>mut</span> <span class='ident'>c_char</span>) {
        <span class='kw'>let</span> <span class='ident'>len</span> <span class='op'>=</span> <span class='ident'>libc</span>::<span class='ident'>strlen</span>(<span class='ident'>ptr</span>) <span class='op'>+</span> <span class='number'>1</span>;
        <span class='kw'>let</span> <span class='ident'>slice</span> <span class='op'>=</span> <span class='ident'>slice</span>::<span class='ident'>from_raw_parts</span>(<span class='ident'>ptr</span>, <span class='ident'>len</span> <span class='kw'>as</span> <span class='ident'>usize</span>);
        <span class='ident'>CString</span>{ <span class='ident'>inner</span>: <span class='ident'>mem</span>::<span class='ident'>transmute</span>(<span class='ident'>slice</span>) }
    }

    <span class='comment'>// ...</span>
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Ause%20libc%3B%0Ause%20memchr%3B%0Ause%20slice%3B%0Ause%20os%3A%3Araw%3A%3Ac_char%3B%0Ause%20mem%3B%0A%2F%2F%20...%0Aimpl%20CString%20%7B%0A%20%20%20%20pub%20fn%20new%3CT%3E(t%3A%20T)%20-%3E%20Result%3CCString%2C%20NulError%3E%0A%20%20%20%20%20%20%20%20where%20T%3A%20Into%3CVec%3Cu8%3E%3E%20%7B%0A%20%20%20%20%20%20%20%20Self%3A%3A_new(t.into())%0A%20%20%20%20%7D%0A%0A%20%20%20%20fn%20_new(bytes%3A%20Vec%3Cu8%3E)%20-%3E%20Result%3CCString%2C%20NulError%3E%20%7B%0A%20%20%20%20%20%20%20%20match%20memchr%3A%3Amemchr(0%2C%20%26bytes)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20Some(i)%20%3D%3E%20Err(NulError(i%2C%20bytes))%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20None%20%3D%3E%20Ok(%20unsafe%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20CString%3A%3Afrom_vec_unchecked(bytes)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20unsafe%20fn%20from_vec_unchecked(mut%20v%3A%20Vec%3Cu8%3E)%20-%3E%20CString%20%7B%0A%20%20%20%20%20%20%20%20v.reserve_exact(1)%3B%0A%20%20%20%20%20%20%20%20v.push(0)%3B%0A%20%20%20%20%20%20%20%20CString%7B%20inner%3A%20v.into_boxed_slice()%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20unsafe%20fn%20from_raw(ptr%3A%20*mut%20c_char)%20%7B%0A%20%20%20%20%20%20%20%20let%20len%20%3D%20libc%3A%3Astrlen(ptr)%20%2B%201%3B%0A%20%20%20%20%20%20%20%20let%20slice%20%3D%20slice%3A%3Afrom_raw_parts(ptr%2C%20len%20as%20usize)%3B%0A%20%20%20%20%20%20%20%20CString%7B%20inner%3A%20mem%3A%3Atransmute(slice)%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%20...%0A%7D%0A%7D">Run</a></pre>

<p><code>new</code> creates a new <code>CString</code> from a container of bytes (which naturally would implement <code>Into&lt;Vec&lt;u8&gt;&gt;</code>). Inside the function, it constructs the <code>Vec&lt;u8&gt;</code> via <code>into</code>, then forward it into the actual implementation, <code>_new</code>. Inside <code>_new</code>, it first checks whether there are any <code>0</code>s in the provided vector (using <code>memchr::memchr</code>, which is super fast). If it find any, then the provided bytes can&#39;t form a valid <code>CString</code>, thus a <code>NulError</code> is returned. If not, we have then safely confirmed that the provided vector can be turned into a valid <code>CString</code>, thus it is further forwarded to the <code>unsafe</code> <code>from_vec_unchecked</code>.</p>

<p><code>from_vec_unchecked</code> creates a <code>CString</code> from a byte vector, without checking for <code>0</code>s. As such, it has been marked as <code>unsafe</code>, meaning that the caller should manually guarantee the invariants of <code>CString</code> being hold. It appends a trailing <code>0</code> byte to the provided vector, then box it to constructs the <code>CString</code>.</p>

<p><code>from_raw</code> creates a <code>CString</code> from a pointer to <code>os::raw::c_char</code>, which represents a <code>char</code> type in C. Being <code>unsafe</code>, callers must ensure that the pointee is <code>0</code>-terminated, and that it is safe to retakes the ownership of the pointee. The pointee is then transferred into an owned <code>CString</code>. The documentation argues that it is only safe to be called with a pointer earlier obtained by calling <code>CString::into_raw</code>.</p>

<p><code>into_raw</code> is among the next set of methods we are about to cover:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>ptr</span>;

<span class='comment'>// ...</span>

<span class='kw'>impl</span> <span class='ident'>CString</span> {
    <span class='comment'>// ...</span>

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>into_raw</span>(<span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>*</span><span class='kw-2'>mut</span> <span class='ident'>c_char</span> {
        <span class='ident'>Box</span>::<span class='ident'>into_raw</span>(<span class='self'>self</span>.<span class='ident'>into_inner</span>()) <span class='kw'>as</span> <span class='kw-2'>*</span><span class='kw-2'>mut</span> <span class='ident'>c_char</span>
    }

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>into_string</span>(<span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Result</span><span class='op'>&lt;</span><span class='ident'>String</span>, <span class='ident'>IntoStringError</span><span class='op'>&gt;</span> {
        <span class='ident'>String</span>::<span class='ident'>from_utf8</span>(<span class='self'>self</span>.<span class='ident'>into_bytes</span>()).<span class='ident'>map_err</span>(<span class='op'>|</span><span class='ident'>e</span><span class='op'>|</span> <span class='ident'>IntoStringError</span> {
            <span class='ident'>error</span>: <span class='ident'>e</span>.<span class='ident'>utf8_error</span>(),
            <span class='ident'>inner</span>: <span class='kw'>unsafe</span> { <span class='ident'>CString</span>::<span class='ident'>from_vec_unchecked</span>(<span class='ident'>e</span>.<span class='ident'>into_bytes</span>()) },
        })
    }

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>into_bytes</span>(<span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>u8</span><span class='op'>&gt;</span> {
        <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>vec</span> <span class='op'>=</span> <span class='self'>self</span>.<span class='ident'>into_inner</span>().<span class='ident'>into_vec</span>();
        <span class='kw'>let</span> <span class='ident'>_mul</span> <span class='op'>=</span> <span class='ident'>vec</span>.<span class='ident'>pop</span>();
        <span class='macro'>debug_assert_eq</span><span class='macro'>!</span>(<span class='ident'>_nul</span>, <span class='prelude-val'>Some</span>(<span class='number'>0u8</span>));
        <span class='ident'>vec</span>
    }

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>into_bytes_with_nul</span>(<span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>Vec</span><span class='op'>&lt;</span><span class='ident'>u8</span><span class='op'>&gt;</span> {
        <span class='self'>self</span>.<span class='ident'>into_inner</span>().<span class='ident'>into_vec</span>()
    }

    <span class='comment'>// ...</span>

    <span class='kw'>fn</span> <span class='ident'>into_inner</span>(<span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>Box</span><span class='op'>&lt;</span>[<span class='ident'>u8</span>]<span class='op'>&gt;</span> {
        <span class='kw'>unsafe</span> {
            <span class='kw'>let</span> <span class='ident'>result</span> <span class='op'>=</span> <span class='ident'>ptr</span>::<span class='ident'>read</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>.<span class='ident'>inner</span>);
            <span class='ident'>mem</span>::<span class='ident'>forget</span>(<span class='self'>self</span>);
            <span class='ident'>result</span>
        }
    }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Ause%20ptr%3B%0A%0A%2F%2F%20...%0A%0Aimpl%20CString%20%7B%0A%20%20%20%20%2F%2F%20...%0A%0A%20%20%20%20pub%20fn%20into_raw(self)%20-%3E%20*mut%20c_char%20%7B%0A%20%20%20%20%20%20%20%20Box%3A%3Ainto_raw(self.into_inner())%20as%20*mut%20c_char%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20into_string(self)%20-%3E%20Result%3CString%2C%20IntoStringError%3E%20%7B%0A%20%20%20%20%20%20%20%20String%3A%3Afrom_utf8(self.into_bytes()).map_err(%7Ce%7C%20IntoStringError%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20error%3A%20e.utf8_error()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20inner%3A%20unsafe%20%7B%20CString%3A%3Afrom_vec_unchecked(e.into_bytes())%20%7D%2C%0A%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20into_bytes(self)%20-%3E%20Vec%3Cu8%3E%20%7B%0A%20%20%20%20%20%20%20%20let%20mut%20vec%20%3D%20self.into_inner().into_vec()%3B%0A%20%20%20%20%20%20%20%20let%20_mul%20%3D%20vec.pop()%3B%0A%20%20%20%20%20%20%20%20debug_assert_eq!(_nul%2C%20Some(0u8))%3B%0A%20%20%20%20%20%20%20%20vec%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20into_bytes_with_nul(self)%20-%3E%20Vec%3Cu8%3E%20%7B%0A%20%20%20%20%20%20%20%20self.into_inner().into_vec()%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%20...%0A%0A%20%20%20%20fn%20into_inner(self)%20-%3E%20Box%3C%5Bu8%5D%3E%20%7B%0A%20%20%20%20%20%20%20%20unsafe%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20result%20%3D%20ptr%3A%3Aread(%26self.inner)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20mem%3A%3Aforget(self)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20result%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>These methods consumes <code>self</code> by value, returning the corresponding type.</p>

<p><code>into_raw</code> transfers the ownership of the string to the returned pointer. Note that deallocation must be done on another <code>CString</code> which is reconstructed via <code>from_raw</code> with the returned pointer. Specifically, one should <em>not</em> use the standard C <code>free</code> function to deallocate it.</p>

<p><code>into_string</code> trys to convert the <code>CString</code> into <code>String</code> and returns it. On failure due to invalid unicode, ownership of the original <code>CString</code> is returned in the <code>Err</code> variant <code>IntoStringError</code>&#39;s <code>inner</code> field.</p>

<p><code>into_bytes</code> returns the underlying byte buffer as a byte vector, with C-string&#39;s trailing <code>0u8</code> removed.</p>

<p><code>into_bytes_with_nul</code> however, returns the byte vector with the trailing <code>0u8</code> preserved.</p>

<p>Also note the <code>into_inner</code>, which is a private utility method used by lots of methods above. It turns the <code>CString</code> into its <code>inner</code> field, using pointer tricks to obtain the inner <code>Box&lt;[u8]&gt;</code>, and the Mighty <code>mem::forget</code> to bypass dropping on the consumed <code>self</code>.</p>

<p>The final set of methods returns an alternative reference into the owned data:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>as_bytes</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span>[<span class='ident'>u8</span>] {
    <span class='kw-2'>&amp;</span><span class='self'>self</span>.<span class='ident'>inner</span>[..<span class='self'>self</span>.<span class='ident'>inner</span>.<span class='ident'>len</span>() <span class='op'>-</span> <span class='number'>1</span>]
}

<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>as_bytes_with_nul</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span>[<span class='ident'>u8</span>] {
    <span class='kw-2'>&amp;</span><span class='self'>self</span>.<span class='ident'>inner</span>
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Apub%20fn%20as_bytes(%26self)%20-%3E%20%26%5Bu8%5D%20%7B%0A%20%20%20%20%26self.inner%5B..self.inner.len()%20-%201%5D%0A%7D%0A%0Apub%20fn%20as_bytes_with_nul(%26self)%20-%3E%20%26%5Bu8%5D%20%7B%0A%20%20%20%20%26self.inner%0A%7D%0A%7D">Run</a></pre>

<p>Besides the above two methods to achive borrowing, the module also defines another new type, <code>CStr</code> to represent a borrowed C string. The relation is analoge to that between <code>String</code> and <code>str</code>:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>pub</span> <span class='kw'>struct</span> <span class='ident'>CStr</span> {
    <span class='comment'>// fields omitted because it is subject to change in the future</span>
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Apub%20struct%20CStr%20%7B%0A%20%20%20%20%2F%2F%20fields%20omitted%20because%20it%20is%20subject%20to%20change%20in%20the%20future%0A%7D%0A%7D">Run</a></pre>

<p>Like <code>str</code>, this is a dynamically sized type. As such, it can only be safely constructed via a borrowed version of a <code>CString</code>. It can also be constructed from a raw C string. Let&#39;s look its implemented methods:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>os</span>::<span class='ident'>raw</span>::<span class='ident'>c_char</span>;
<span class='kw'>use</span> <span class='ident'>libc</span>;
<span class='kw'>use</span> <span class='ident'>mem</span>;
<span class='kw'>use</span> <span class='ident'>slice</span>;
<span class='kw'>use</span> <span class='ident'>memchr</span>;
<span class='comment'>//...</span>

<span class='kw'>impl</span> <span class='ident'>CStr</span> {
    <span class='kw'>pub</span> <span class='kw'>unsafe</span> <span class='kw'>fn</span> <span class='ident'>from_ptr</span><span class='op'>&lt;</span><span class='lifetime'>&#39;a</span><span class='op'>&gt;</span>(<span class='ident'>ptr</span>: <span class='kw-2'>*</span><span class='kw'>const</span> <span class='ident'>c_char</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;a</span> <span class='ident'>CStr</span> {
        <span class='kw'>let</span> <span class='ident'>len</span> <span class='op'>=</span> <span class='ident'>libc</span>::<span class='ident'>strlen</span>(<span class='ident'>ptr</span>);
        <span class='ident'>mem</span>::<span class='ident'>transmute</span>(<span class='ident'>slice</span>::<span class='ident'>from_raw_parts</span>(<span class='ident'>ptr</span>, <span class='ident'>len</span> <span class='kw'>as</span> <span class='ident'>unsize</span> <span class='op'>+</span> <span class='number'>1</span>));
    }

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>from_bytes_with_nul</span>(<span class='ident'>bytes</span>: <span class='kw-2'>&amp;</span>[<span class='ident'>u8</span>])
        <span class='op'>-&gt;</span> <span class='prelude-ty'>Result</span><span class='op'>&lt;</span><span class='kw-2'>&amp;</span><span class='ident'>CStr</span>, <span class='ident'>FromBytesWithNulError</span><span class='op'>&gt;</span> {
        <span class='kw'>if</span> <span class='ident'>bytes</span>.<span class='ident'>is_empty</span>() 
            <span class='op'>||</span> <span class='ident'>memchr</span>::<span class='ident'>memchr</span>(<span class='number'>0</span>, <span class='kw-2'>&amp;</span><span class='ident'>bytes</span>) <span class='op'>!=</span> <span class='prelude-val'>Some</span>(<span class='ident'>bytes</span>.<span class='ident'>len</span>() <span class='op'>-</span><span class='number'>1</span> ) {
            <span class='prelude-val'>Err</span>(<span class='ident'>FromBytesWithNulError</span> { <span class='ident'>_a</span>: () })
        } <span class='kw'>else</span> {
            <span class='prelude-val'>Ok</span>(<span class='kw'>unsafe</span> {
                <span class='self'>Self</span>::<span class='ident'>from_bytes_with_nul_unchecked</span>(<span class='ident'>bytes</span>)
            })
        }
    }

    <span class='kw'>pub</span> <span class='kw'>unsafe</span> <span class='kw'>fn</span> <span class='ident'>from_bytes_with_nul_unchecked</span>(<span class='ident'>bytes</span>: <span class='kw-2'>&amp;</span>[<span class='ident'>u8</span>])
        <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='ident'>CStr</span> {
        <span class='ident'>mem</span>::<span class='ident'>transmute</span>(<span class='ident'>bytes</span>);
    }

    <span class='comment'>// ...</span>
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Ause%20os%3A%3Araw%3A%3Ac_char%3B%0Ause%20libc%3B%0Ause%20mem%3B%0Ause%20slice%3B%0Ause%20memchr%3B%0A%2F%2F...%0A%0Aimpl%20CStr%20%7B%0A%20%20%20%20pub%20unsafe%20fn%20from_ptr%3C'a%3E(ptr%3A%20*const%20c_char)%20-%3E%20%26'a%20CStr%20%7B%0A%20%20%20%20%20%20%20%20let%20len%20%3D%20libc%3A%3Astrlen(ptr)%3B%0A%20%20%20%20%20%20%20%20mem%3A%3Atransmute(slice%3A%3Afrom_raw_parts(ptr%2C%20len%20as%20unsize%20%2B%201))%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20from_bytes_with_nul(bytes%3A%20%26%5Bu8%5D)%0A%20%20%20%20%20%20%20%20-%3E%20Result%3C%26CStr%2C%20FromBytesWithNulError%3E%20%7B%0A%20%20%20%20%20%20%20%20if%20bytes.is_empty()%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%7C%7C%20memchr%3A%3Amemchr(0%2C%20%26bytes)%20!%3D%20Some(bytes.len()%20-1%20)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20Err(FromBytesWithNulError%20%7B%20_a%3A%20()%20%7D)%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20Ok(unsafe%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Self%3A%3Afrom_bytes_with_nul_unchecked(bytes)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20unsafe%20fn%20from_bytes_with_nul_unchecked(bytes%3A%20%26%5Bu8%5D)%0A%20%20%20%20%20%20%20%20-%3E%20%26CStr%20%7B%0A%20%20%20%20%20%20%20%20mem%3A%3Atransmute(bytes)%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%20...%0A%7D%0A%7D">Run</a></pre>

<p>These methods, as their names suggest, constructs a reference from data provided.</p>

<p><code>from_ptr</code> casts a raw C string to a <code>&amp; CStr</code>. Being <code>unsafe</code>, callers must guarantee that:
- <code>ptr</code> is pointing to a valid C string.
- The returned lifetime won&#39;t outlive the actual lifetime of <code>ptr</code>&#39;s pointee.</p>

<p><code>from_bytes_with_nul_unchecked</code> creates a <code>&amp; CStr</code> from byte slice. Being <code>unsafe</code>, callers must ensure that the provided bytes is null terminated and contain no interior bytes.</p>

<p><code>from_bytes_with_nul</code> also creates a <code>&amp; CStr</code> from byte slice, but does some safety checks upfront to ensure that the resulting <code>&amp; CStr</code> is valid.</p>

<p>Then we have some methods for conversion:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>impl</span> <span class='ident'>CStr</span> {
    <span class='comment'>// ...</span>
    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>as_ptr</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>*</span><span class='kw'>const</span> <span class='ident'>c_char</span> {<span class='comment'>/* ... */</span>}

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>to_bytes</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span>[<span class='ident'>u8</span>] {<span class='comment'>/* ... */</span>}

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>to_bytes_with_nul</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span>[<span class='ident'>u8</span>] {<span class='comment'>/* ... */</span>}

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>to_str</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Result</span><span class='op'>&lt;</span><span class='kw-2'>&amp;</span><span class='ident'>str</span>, <span class='ident'>std</span>::<span class='ident'>str</span>::<span class='ident'>Utf8Error</span><span class='op'>&gt;</span> {<span class='comment'>/* ... */</span>}

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>to_string_lossy</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='ident'>str</span><span class='op'>&gt;</span> {<span class='comment'>/* ... */</span>}

}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Aimpl%20CStr%20%7B%0A%20%20%20%20%2F%2F%20...%0A%20%20%20%20pub%20fn%20as_ptr(%26self)%20-%3E%20*const%20c_char%20%7B%2F*%20...%20*%2F%7D%0A%0A%20%20%20%20pub%20fn%20to_bytes(%26self)%20-%3E%20%26%5Bu8%5D%20%7B%2F*%20...%20*%2F%7D%0A%0A%20%20%20%20pub%20fn%20to_bytes_with_nul(%26self)%20-%3E%20%26%5Bu8%5D%20%7B%2F*%20...%20*%2F%7D%0A%0A%20%20%20%20pub%20fn%20to_str(%26self)%20-%3E%20Result%3C%26str%2C%20std%3A%3Astr%3A%3AUtf8Error%3E%20%7B%2F*%20...%20*%2F%7D%0A%0A%20%20%20%20pub%20fn%20to_string_lossy(%26self)%20-%3E%20Cow%3Cstr%3E%20%7B%2F*%20...%20*%2F%7D%0A%0A%7D%0A%7D">Run</a></pre>

<p>The implementation of these methods are subject to changes thus are not listed.</p>

<p>Note the <code>to_str</code>, which would yield a string slice if it contains valid UTF8. If not, an <code>Err</code> is returned.</p>

<p>The <code>to_string_lossy</code> method however, will replace any invalid UTF8 sequences with <code>U+FFFD</code>(the replacement character). As such replacement is costy, the method returns a <code>Cow&lt;str&gt;</code>.</p>

<p><code>CStr</code> implements <code>Hash</code>, <code>Debug</code>, <code>PartialEq</code>, <code>Eq</code>, <code>PartialOrd</code>, <code>Ord</code>, <code>ToOwned&lt;Owned=CString&gt;</code>, <code>AsRef&lt;CStr&gt;</code>.</p>

<p>Additionally, <code>&amp;&#39;a CStr</code> implements <code>Default</code>.</p>

<p>As an owned <code>CStr</code>, naturally, <code>CString</code> implements <code>Deref&lt;Target=CStr&gt;</code>. As such, methods discussed above are also invokable on a <code>CString</code>.</p>

<p>In addition, <code>CString</code> also implements <code>Default</code>, <code>Borrow&lt;CStr&gt;</code>, <code>From&lt;&amp;&#39;a CStr&gt;</code>, <code>AsRef&lt;CStr&gt;</code>, <code>Index&lt;RangeFull&gt;</code>.</p>

<h1 id='osstring' class='section-header'><a href='#osstring'>OsString</a></h1>
<p>Platform-native strings are not necessarily valid UTF8 or C string. As such, we need a type to represent them. Just like the <code>CString</code>, <code>CStr</code> pair, this module also defines <code>OsString</code>, <code>OsStr</code> for this purpose:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>use</span> <span class='ident'>sys</span>::<span class='ident'>os_str</span>::{<span class='ident'>Buf</span>, <span class='ident'>Slice</span>};

<span class='kw'>pub</span> <span class='kw'>struct</span> <span class='ident'>OsString</span> {
    <span class='ident'>inner</span>: <span class='ident'>Buf</span>
}

<span class='kw'>pub</span> <span class='kw'>struct</span> <span class='ident'>OsStr</span> {
    <span class='ident'>inner</span>: <span class='ident'>Slice</span>
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Ause%20sys%3A%3Aos_str%3A%3A%7BBuf%2C%20Slice%7D%3B%0A%0Apub%20struct%20OsString%20%7B%0A%20%20%20%20inner%3A%20Buf%0A%7D%0A%0Apub%20struct%20OsStr%20%7B%0A%20%20%20%20inner%3A%20Slice%0A%7D%0A%7D">Run</a></pre>

<p>To construct an <code>OsString</code>:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>impl</span> <span class='ident'>OsString</span> {
    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>new</span>() <span class='op'>-&gt;</span> <span class='ident'>OsString</span> {
        <span class='ident'>OsString</span> { <span class='ident'>inner</span>: <span class='ident'>Buf</span>::<span class='ident'>from_string</span>(<span class='ident'>String</span>::<span class='ident'>new</span>()) }
    }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Aimpl%20OsString%20%7B%0A%20%20%20%20pub%20fn%20new()%20-%3E%20OsString%20%7B%0A%20%20%20%20%20%20%20%20OsString%20%7B%20inner%3A%20Buf%3A%3Afrom_string(String%3A%3Anew())%20%7D%0A%20%20%20%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>Optionally, construct it with a default capacity:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>impl</span> <span class='ident'>OsString</span> {
    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>with_capacity</span>(<span class='ident'>capacity</span>: <span class='ident'>usize</span>) <span class='op'>-&gt;</span> <span class='ident'>OsString</span> {
        <span class='ident'>OsString</span> { <span class='ident'>inner</span>: <span class='ident'>Buf</span>::<span class='ident'>with_capacity</span>(<span class='ident'>capacity</span>) }
    }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Aimpl%20OsString%20%7B%0A%20%20%20%20pub%20fn%20with_capacity(capacity%3A%20usize)%20-%3E%20OsString%20%7B%0A%20%20%20%20%20%20%20%20OsString%20%7B%20inner%3A%20Buf%3A%3Awith_capacity(capacity)%20%7D%0A%20%20%20%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>To borrow it as an <code>&amp;OsStr</code>:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>impl</span> <span class='ident'>OsString</span> {
    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>as_os_str</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='ident'>OsStr</span> {
        <span class='self'>self</span>
    }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Aimpl%20OsString%20%7B%0A%20%20%20%20pub%20fn%20as_os_str(%26self)%20-%3E%20%26OsStr%20%7B%0A%20%20%20%20%20%20%20%20self%0A%20%20%20%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>To consume and try to convert it into a Rust <code>String</code>:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>impl</span> <span class='ident'>OsString</span> {
    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>into_string</span>(<span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Result</span><span class='op'>&lt;</span><span class='ident'>String</span>, <span class='ident'>OsString</span><span class='op'>&gt;</span> {
        <span class='self'>self</span>.<span class='ident'>inner</span>.<span class='ident'>into_string</span>()
            .<span class='ident'>map_err</span>(<span class='op'>|</span><span class='ident'>buf</span><span class='op'>|</span><span class='ident'>OsString</span> { <span class='ident'>inner</span>: <span class='ident'>buf</span>} )
    }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Aimpl%20OsString%20%7B%0A%20%20%20%20pub%20fn%20into_string(self)%20-%3E%20Result%3CString%2C%20OsString%3E%20%7B%0A%20%20%20%20%20%20%20%20self.inner.into_string()%0A%20%20%20%20%20%20%20%20%20%20%20%20.map_err(%7Cbuf%7COsString%20%7B%20inner%3A%20buf%7D%20)%0A%20%20%20%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>To extends and to clear:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>impl</span> <span class='ident'>OsString</span> {
    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>push</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>, <span class='ident'>s</span>: <span class='ident'>T</span>)
        <span class='kw'>where</span> <span class='ident'>T</span>: <span class='ident'>AsRef</span><span class='op'>&lt;</span><span class='ident'>OsStr</span><span class='op'>&gt;</span> {
        <span class='self'>self</span>.<span class='ident'>inner</span>.<span class='ident'>push_slice</span>(<span class='kw-2'>&amp;</span><span class='ident'>s</span>.<span class='ident'>as_ref</span>().<span class='ident'>inner</span>)
    }

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>clear</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>) {
        <span class='self'>self</span>.<span class='ident'>inner</span>.<span class='ident'>clear</span>()
    }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Aimpl%20OsString%20%7B%0A%20%20%20%20pub%20fn%20push%3CT%3E(%26mut%20self%2C%20s%3A%20T)%0A%20%20%20%20%20%20%20%20where%20T%3A%20AsRef%3COsStr%3E%20%7B%0A%20%20%20%20%20%20%20%20self.inner.push_slice(%26s.as_ref().inner)%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20clear(%26mut%20self)%20%7B%0A%20%20%20%20%20%20%20%20self.inner.clear()%0A%20%20%20%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>To query, or to reserve for capacity:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>capacity</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>usize</span> {
    <span class='self'>self</span>.<span class='ident'>inner</span>.<span class='ident'>capacity</span>()
}

<span class='comment'>// reserve at least `additional` more capacity</span>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>reserve</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>, <span class='ident'>additional</span>: <span class='ident'>usize</span>) {
    <span class='self'>self</span>.<span class='ident'>inner</span>.<span class='ident'>reserve</span>(<span class='ident'>additional</span>)
}

<span class='comment'>// reserve the minimum capacity for exactly `additional` more capacity</span>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>reserve_exact</span>(<span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='self'>self</span>, <span class='ident'>additional</span>: <span class='ident'>usize</span>) {
    <span class='self'>self</span>.<span class='ident'>inner</span>.<span class='ident'>reserve_exact</span>(<span class='ident'>additional</span>)
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Apub%20fn%20capacity(%26self)%20-%3E%20usize%20%7B%0A%20%20%20%20self.inner.capacity()%0A%7D%0A%0A%2F%2F%20reserve%20at%20least%20%60additional%60%20more%20capacity%0Apub%20fn%20reserve(%26mut%20self%2C%20additional%3A%20usize)%20%7B%0A%20%20%20%20self.inner.reserve(additional)%0A%7D%0A%0A%2F%2F%20reserve%20the%20minimum%20capacity%20for%20exactly%20%60additional%60%20more%20capacity%0Apub%20fn%20reserve_exact(%26mut%20self%2C%20additional%3A%20usize)%20%7B%0A%20%20%20%20self.inner.reserve_exact(additional)%0A%7D%0A%7D">Run</a></pre>

<p>It also implements <code>Clone</code>, <code>From&lt;String&gt;</code>, <code>From&lt;&amp;&#39;a T&gt; where T: AsRef&lt;OsStr&gt; + ?Sized</code>, <code>Index&lt;RangeFull, Output=OsStr&gt;</code>, <code>Deref&lt;Target=OsStr&gt;</code>, <code>Default</code>, <code>Debug</code>, <code>PartialEq</code>, <code>PartialEq&lt;str&gt;</code>, <code>Eq</code>, <code>PartialOrd</code>, <code>PartialOrd&lt;str&gt;</code>, <code>Ord</code>, <code>Hash</code>, <code>Borrow&lt;OsStr&gt;</code>, <code>AsRef&lt;OsStr&gt;</code>, <code>From&lt;PathBuf&gt;</code>, <code>AsRef&lt;Path&gt;</code> etc.</p>

<p><code>OsStr</code> has the following methods implemented:</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>impl</span> <span class='ident'>OsStr</span> {
    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>new</span><span class='op'>&lt;</span><span class='ident'>S</span><span class='op'>&gt;</span>(<span class='ident'>s</span>: <span class='kw-2'>&amp;</span><span class='ident'>S</span>) <span class='op'>-&gt;</span> <span class='kw-2'>&amp;</span><span class='ident'>OsStr</span>
        <span class='kw'>where</span> <span class='ident'>S</span>: <span class='ident'>AsRef</span><span class='op'>&lt;</span><span class='ident'>OsStr</span><span class='op'>&gt;</span> <span class='op'>+</span> <span class='question-mark'>?</span><span class='ident'>Sized</span> {
        <span class='ident'>s</span>.<span class='ident'>as_ref</span>()
    }

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>to_str</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Option</span><span class='op'>&lt;</span><span class='kw-2'>&amp;</span><span class='ident'>str</span><span class='op'>&gt;</span> {
        <span class='self'>self</span>.<span class='ident'>inner</span>.<span class='ident'>to_str</span>()
    }

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>to_string_lossy</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>Cow</span><span class='op'>&lt;</span><span class='ident'>str</span><span class='op'>&gt;</span> {
        <span class='comment'>// ...</span>
    }

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>to_os_string</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>OsString</span> {
        <span class='ident'>OsString</span> { <span class='ident'>inner</span>: <span class='self'>self</span>.<span class='ident'>inner</span>.<span class='ident'>to_owned</span>() }
    }

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>is_empty</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>bool</span> {
        <span class='self'>self</span>.<span class='ident'>inner</span>.<span class='ident'>inner</span>.<span class='ident'>is_empty</span>()
    }

    <span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>len</span>(<span class='kw-2'>&amp;</span><span class='self'>self</span>) <span class='op'>-&gt;</span> <span class='ident'>usize</span> {
        <span class='self'>self</span>.<span class='ident'>inner</span>.<span class='ident'>inner</span>.<span class='ident'>len</span>()
    }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Aimpl%20OsStr%20%7B%0A%20%20%20%20pub%20fn%20new%3CS%3E(s%3A%20%26S)%20-%3E%20%26OsStr%0A%20%20%20%20%20%20%20%20where%20S%3A%20AsRef%3COsStr%3E%20%2B%20%3FSized%20%7B%0A%20%20%20%20%20%20%20%20s.as_ref()%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20to_str(%26self)%20-%3E%20Option%3C%26str%3E%20%7B%0A%20%20%20%20%20%20%20%20self.inner.to_str()%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20to_string_lossy(%26self)%20-%3E%20Cow%3Cstr%3E%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20...%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20to_os_string(%26self)%20-%3E%20OsString%20%7B%0A%20%20%20%20%20%20%20%20OsString%20%7B%20inner%3A%20self.inner.to_owned()%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20is_empty(%26self)%20-%3E%20bool%20%7B%0A%20%20%20%20%20%20%20%20self.inner.inner.is_empty()%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20len(%26self)%20-%3E%20usize%20%7B%0A%20%20%20%20%20%20%20%20self.inner.inner.len()%0A%20%20%20%20%7D%0A%7D%0A%7D">Run</a></pre>

<p>It implements <code>Defualt</code>, <code>Hash</code>, <code>Debug</code>, <code>AsRef&lt;OsStr&gt;</code>, <code>AsRef&lt;Path&gt;</code>, and some comparison traits.</p>

    <script src='rustbook.js'></script>
</div></div>


</body>
</html>