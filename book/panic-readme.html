<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>std::panic</title>

    <link rel="stylesheet" type="text/css" href="rustbook.css">

    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    
                <div id="nav">
                    <button id="toggle-nav">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                    </button>
                </div>
<div id='toc' class='mobile-hidden'>
<ol class='chapter'>
<li><a  href='README.html'><b>1.</b> Introduction</a>
</li>
<li><a  href='macros-readme.html'><b>2.</b> Macros in std</a>
</li>
<li><a  href='mods-readme.html'><b>3.</b> Uncategorized Modules</a>
<ol class='section'>
<li><a  href='any-readme.html'><b>3.1.</b> std::any</a>
</li>
<li><a  href='ascii-readme.html'><b>3.2.</b> std::ascii</a>
</li>
<li><a  href='borrow-readme.html'><b>3.3.</b> std::borrow</a>
</li>
<li><a  href='boxed-readme.html'><b>3.4.</b> std::boxed</a>
</li>
<li><a  href='cell-readme.html'><b>3.5.</b> std::cell</a>
</li>
<li><a  href='clone-readme.html'><b>3.6.</b> std::clone</a>
</li>
<li><a  href='cmp-readme.html'><b>3.7.</b> std::cmp</a>
</li>
<li><a  href='collections-readme.html'><b>3.8.</b> std::collections</a>
</li>
<li><a  href='convert-readme.html'><b>3.9.</b> std::convert</a>
</li>
<li><a  href='default-readme.html'><b>3.10.</b> std::default</a>
</li>
<li><a  href='env-readme.html'><b>3.11.</b> std::env</a>
</li>
<li><a  href='error-readme.html'><b>3.12.</b> std::error</a>
</li>
<li><a  href='ffi-readme.html'><b>3.13.</b> std::ffi</a>
</li>
<li><a  href='fmt-readme.html'><b>3.14.</b> std::fmt</a>
</li>
<li><a  href='fs-readme.html'><b>3.15.</b> std::fs</a>
</li>
<li><a  href='hash-readme.html'><b>3.16.</b> std::hash</a>
</li>
<li><a  href='io-readme.html'><b>3.17.</b> std::io</a>
</li>
<li><a  href='iter-readme.html'><b>3.18.</b> std::iter</a>
</li>
<li><a  href='marker-readme.html'><b>3.19.</b> std::marker</a>
</li>
<li><a  href='mem-readme.html'><b>3.20.</b> std::mem</a>
</li>
<li><a  href='net-readme.html'><b>3.21.</b> std::net</a>
</li>
<li><a  href='num-readme.html'><b>3.22.</b> std::num</a>
</li>
<li><a  href='ops-readme.html'><b>3.23.</b> std::ops</a>
</li>
<li><a  href='option-readme.html'><b>3.24.</b> std::option</a>
</li>
<li><a  href='os-readme.html'><b>3.25.</b> std::os</a>
</li>
<li><a class='active' href='panic-readme.html'><b>3.26.</b> std::panic</a>
</li>
<li><a  href='path-readme.html'><b>3.27.</b> std::path</a>
</li>
<li><a  href='prelude-readme.html'><b>3.28.</b> std::prelude</a>
</li>
<li><a  href='process-readme.html'><b>3.29.</b> std::process</a>
</li>
</ol>
</li>
</ol>
</div>
<div id='page-wrapper'>
<div id='page'>


    <h1 class="title">std::panic</h1>
    <p>This module provides some functions to deal with unwinding panics.</p>

<p>Firstly, there is</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>set_hook</span>(<span class='ident'>hook</span>: <span class='ident'>Box</span><span class='op'>&lt;</span><span class='ident'>Fn</span>(<span class='kw-2'>&amp;</span><span class='ident'>PanicInfo</span>) <span class='op'>+</span> <span class='lifetime'>&#39;static</span> <span class='op'>+</span> <span class='ident'>Sync</span> <span class='op'>+</span> <span class='ident'>Send</span><span class='op'>&gt;</span>)<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Apub%20fn%20set_hook(hook%3A%20Box%3CFn(%26PanicInfo)%20%2B%20'static%20%2B%20Sync%20%2B%20Send%3E)%0A%7D">Run</a></pre>

<p>After the panic yet before the panic runtime gets invoked, a hook function would get called. The default hook that we&#39;ve all been familiar with prints a message to <code>stderr</code> and generates a backtrace (if requested). This function gives us the chance to customize the behavior of the hook. It registers a customized panic <code>hook</code>, replacing any existing hook.</p>

<p><code>hook</code> should be a function object taking a <code>&amp;PanicInfo</code> as input. <code>PanicInfo</code> contains information about a panic. To retrieve the info one can:</p>

<ul>
<li>call the associated method <code>payload(&amp;self) -&gt; &amp;Any + Send</code> to get the payload associated with the panic. The underlying type of the payload is typically a <code>&amp;&#39;static str</code> (as is the case of <code>panic!(&quot;foo&quot;)</code>) or a <code>String</code> ( when the string needs to be formatted by runtime info), but it can be objects of other types.</li>
<li>call the associated method <code>location(&amp;self) -&gt; Option&lt;&amp;Location&gt;</code> to get the location where the panic originated, if available.</li>
</ul>

<p>The counterpart of this function is</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>take_hook</span>() <span class='op'>-&gt;</span> <span class='ident'>Box</span><span class='op'>&lt;</span><span class='ident'>Fn</span>(<span class='kw-2'>&amp;</span><span class='ident'>PanicInfo</span>) <span class='op'>+</span> <span class='lifetime'>&#39;static</span> <span class='op'>+</span> <span class='ident'>Sync</span> <span class='op'>+</span> <span class='ident'>Send</span><span class='op'>&gt;</span><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Apub%20fn%20take_hook()%20-%3E%20Box%3CFn(%26PanicInfo)%20%2B%20'static%20%2B%20Sync%20%2B%20Send%3E%0A%7D">Run</a></pre>

<p>which unregisters and returns the current panic hook.</p>

<hr>

<p>Then there is</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>catch_unwind</span><span class='op'>&lt;</span><span class='ident'>F</span>, <span class='ident'>R</span><span class='op'>&gt;</span>(<span class='ident'>f</span>: <span class='ident'>F</span>) <span class='op'>-&gt;</span> <span class='prelude-ty'>Result</span><span class='op'>&lt;</span><span class='ident'>R</span>, <span class='ident'>Box</span><span class='op'>&lt;</span><span class='ident'>Any</span><span class='op'>+</span><span class='ident'>Send</span><span class='op'>+</span><span class='lifetime'>&#39;static</span><span class='op'>&gt;&gt;</span>
    <span class='kw'>where</span> <span class='ident'>F</span>: <span class='ident'>UnwindSafe</span> <span class='op'>+</span> <span class='ident'>FnOnce</span>() <span class='op'>-&gt;</span> <span class='ident'>R</span><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Apub%20fn%20catch_unwind%3CF%2C%20R%3E(f%3A%20F)%20-%3E%20Result%3CR%2C%20Box%3CAny%2BSend%2B'static%3E%3E%0A%20%20%20%20where%20F%3A%20UnwindSafe%20%2B%20FnOnce()%20-%3E%20R%0A%7D">Run</a></pre>

<p>The function takes a function object and invokes it. During its invocation, if the invocation panics, an <code>Err(cause)</code> would be returned with the <code>cause</code> being the object with which the panic was originally invoked. Otherwise, an <code>Ok</code> would be returned which contains the result of this call.</p>

<p>The function is primarily used when some Rust code needs to be called from another language. As it is currently UB to unwind into a foreign code, turning a possibly panic into a <code>Result</code> would allow a graceful handling of the error to become possible. It is <strong>not</strong> recommended to use this function as a &quot;try/catch&quot; mechanism within Rust, as panicking is only meant to be used by <em>non-recoverable</em> errors. In Rust, such a mechanism would be better off implemented via directly returning <code>Result</code>.</p>

<p>Note that the provided function object is required to adhere to the <code>UnwindSafe</code> marker trait. The trait represents a type with &quot;unwinding safety&quot;, meaning that the implementing type cannot easily allow witnessing of a broken invariant through the <code>catch_unwind</code> boundary.<sup id="fnref1"><a href="#fn1" rel="footnote">1</a></sup> Just like <code>Send</code> and <code>Sync</code>, this trait is automatically implemented by the compiler when it find appropriate. Basically speaking, types with logical mutability (such as <code>&amp;mut T</code> and <code>&amp;RefCell&lt;T&gt;</code>) would be marked as <code>!UnwindSafe</code>.</p>

<p>The counterpart of <code>catch_unwind</code> is</p>

<pre class='rust rust-example-rendered'>
<span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>resume_unwind</span>(<span class='ident'>payload</span>: <span class='ident'>Box</span><span class='op'>&lt;</span><span class='ident'>Any</span> <span class='op'>+</span> <span class='ident'>Send</span><span class='op'>&gt;</span>) <span class='op'>-&gt;</span> <span class='op'>!</span><a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=fn%20main()%20%7B%0Apub%20fn%20resume_unwind(payload%3A%20Box%3CAny%20%2B%20Send%3E)%20-%3E%20!%0A%7D">Run</a></pre>

<p>which would trigger a panic with the provided payload without invoking the panic hook.</p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>The actual definition is pretty involved, see the <a href="https://github.com/rust-lang/rfcs/blob/master/text/1236-stabilize-catch-panic.html">related RFC</a>.&nbsp;<a href="#fnref1" rev="footnote">&#8617;</a></p>
</li>

</ol>
</div>

    <script src='rustbook.js'></script>
</div></div>


</body>
</html>